<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
<style type="text/css">
			td, th {
		  border-width: 1px;
		  padding: 0.5em;
		  position: relative;
		  text-align: left;
		  border-radius: 0.25em;
		  border-style: solid;
		}

		table.meta:after, table.balance:after {
		  clear: both;
		  content: "";
		  display: table;
		}

		.add, .cut {
		  border-width: 1px;
		  display: block;
		  font-size: .8rem;
		  padding: 0.25em 0.5em;
		  float: left;
		  text-align: center;
		  width: 0.6em;
		  background: #9af;
		  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
		  background-image: -moz-linear-gradient(#00adee 5%, #0078a5 100%);
		  background-image: -webkit-linear-gradient(#00adee 5%, #0078a5 100%);
		  border-radius: 0.5em;
		  border-color: #0076a3;
		  color: #fff;
		  cursor: pointer;
		  font-weight: bold;
		  text-shadow: 0 -1px 2px rgba(0, 0, 0, 0.33);
		}

		

		*[contenteditable] {
		  border-radius: 0.25em;
		  min-width: 1em;
		  outline: 0;
		  cursor: pointer;
		}
		*[contenteditable]:hover {
		  background: #def;
		  box-shadow: 0 0 1em 0.5em #def;
		}
		*[contenteditable]:focus {
		  background: #def;
		  box-shadow: 0 0 1em 0.5em #def;
		}

		td {
		  border-color: #ddd;
		}
		td:hover *[contenteditable] {
		  background: #def;
		  box-shadow: 0 0 1em 0.5em #def;
		}
		td:focus *[contenteditable] {
		  background: #def;
		  box-shadow: 0 0 1em 0.5em #def;
		}

		span[contenteditable] {
		  display: inline-block;
		}

		h1 {
		  font: bold 100% sans-serif;
		  letter-spacing: 0.5em;
		  text-align: center;
		  text-transform: uppercase;
		}

		table {
		  font-size: 75%;
		  table-layout: fixed;
		  width: 100%;
		  border-collapse: separate;
		  border-spacing: 2px;
		}
		table.meta {
		  margin: 0 0 3em;
		  float: right;
		  width: 36%;
		}
		table.meta th {
		  width: 40%;
		}
		table.meta td {
		  width: 60%;
		}
		table.inventory {
		  margin: 0 0 3em;
		  clear: both;
		  width: 100%;
		}
		table.inventory th {
		  font-weight: bold;
		  text-align: center;
		}
		table.inventory td:nth-child(1) {
		  width: 26%;
		}
		table.inventory td:nth-child(2) {
		  width: 38%;
		}
		table.inventory td:nth-child(3) {
		  text-align: right;
		  width: 12%;
		}
		table.inventory td:nth-child(4) {
		  text-align: right;
		  width: 12%;
		}
		table.inventory td:nth-child(5) {
		  text-align: right;
		  width: 12%;
		}
		table.balance {
		  float: right;
		  width: 36%;
		}
		table.balance th {
		  width: 50%;
		}
		table.balance td {
		  width: 50%;
		  text-align: right;
		}

		th {
		  background: #eee;
		  border-color: #bbb;
		}



		header {
		  margin: 0 0 3em;
		}
		header:after {
		  clear: both;
		  content: "";
		  display: table;
		}
		header h1 {
		  background: #000;
		  border-radius: 0.25em;
		  color: #fff;
		  margin: 0 0 1em;
		  padding: 0.5em 0;
		}
		header address {
		  float: left;
		  font-size: 75%;
		  font-style: normal;
		  line-height: 1.25;
		  margin: 0 1em 1em 0;
		}
		header address p {
		  margin: 0 0 0.25em;
		}
		header span {
		  display: block;
		  float: right;
		  margin: 0 0 1em 1em;
		  max-height: 25%;
		  max-width: 60%;
		  position: relative;
		}
		header img {
		  display: block;
		  float: left;
		  max-height: 100%;
		  max-width: 100%;
		}
		header input {
		  cursor: pointer;
		  -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";
		  height: 100%;
		  left: 0;
		  opacity: 0;
		  position: absolute;
		  top: 0;
		  width: 100%;
		}

		article {
		  margin: 0 0 3em;
		}
		article address {
		  margin: 0 0 3em;
		  float: left;
		  font-size: 125%;
		  font-weight: bold;
		}
		article:after {
		  clear: both;
		  content: "";
		  display: table;
		}
		article h1 {
		  clip: rect(0 0 0 0);
		  position: absolute;
		}

		.add {
		  margin: -2.5em 0 0;
		}
		.add:hover {
		  background: #00adee;
		}

		.cut {
		  opacity: 0;
		  position: absolute;
		  top: 0;
		  left: -1.5em;
		  -webkit-transition: opacity 100ms ease-in;
		}

		@media print {
		  * {
		    -webkit-print-color-adjust: exact;
		  }

		  html {
		    background: none;
		    padding: 0;
		  }

		  body {
		    box-shadow: none;
		    margin: 0;
		  }

		  .add {
		    display: none;
		  }

		  .cut {
		    display: none;
		  }

		  span:empty {
		   
		  }
		}
		@page {
		  margin: 0;
		}
		img.hover {
		  background: #def;
		  box-shadow: 0 0 1em 0.5em #def;
		}

		aside h1 {
		  border: none;
		  border-width: 0 0 1px;
		  margin: 0 0 1em;
		  border-color: #999;
		  border-bottom-style: solid;
		}

		tr:hover .cut {
		  opacity: 1;
		}

</style>

<script type="text/javascript">

		(function(document) {
		  var
		  head = document.head = document.getElementsByTagName('head')[0] || document.documentElement,
		      elements = 'article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output picture progress section summary time video x'.split(' '),
		      elementsLength = elements.length,
		      elementsIndex = 0,
		      element;

		  while (elementsIndex < elementsLength) {
		    element = document.createElement(elements[++elementsIndex]);
		  }

		  element.innerHTML = 'x<style>' +
		    'article,aside,details,figcaption,figure,footer,header,hgroup,nav,section{display:block}' +
		    'audio[controls],canvas,video{display:inline-block}' +
		    '[hidden],audio{display:none}' +
		    'mark{background:#FF0;color:#000}' +
		    '</style>';

		  return head.insertBefore(element.lastChild, head.firstChild);
		})(document);

		/* Prototyping
		/* ========================================================================== */

		(function(window, ElementPrototype, ArrayPrototype, polyfill) {
		  function NodeList() {
		    [polyfill]
		  }
		  NodeList.prototype.length = ArrayPrototype.length;

		  ElementPrototype.matchesSelector = ElementPrototype.matchesSelector || ElementPrototype.mozMatchesSelector || ElementPrototype.msMatchesSelector || ElementPrototype.oMatchesSelector || ElementPrototype.webkitMatchesSelector || function matchesSelector(selector) {
		    return ArrayPrototype.indexOf.call(this.parentNode.querySelectorAll(selector), this) > -1;
		  };

		  ElementPrototype.ancestorQuerySelectorAll = ElementPrototype.ancestorQuerySelectorAll || ElementPrototype.mozAncestorQuerySelectorAll || ElementPrototype.msAncestorQuerySelectorAll || ElementPrototype.oAncestorQuerySelectorAll || ElementPrototype.webkitAncestorQuerySelectorAll || function ancestorQuerySelectorAll(selector) {
		    for (var cite = this, newNodeList = new NodeList; cite = cite.parentElement;) {
		      if (cite.matchesSelector(selector)) ArrayPrototype.push.call(newNodeList, cite);
		    }

		    return newNodeList;
		  };

		  ElementPrototype.ancestorQuerySelector = ElementPrototype.ancestorQuerySelector || ElementPrototype.mozAncestorQuerySelector || ElementPrototype.msAncestorQuerySelector || ElementPrototype.oAncestorQuerySelector || ElementPrototype.webkitAncestorQuerySelector || function ancestorQuerySelector(selector) {
		    return this.ancestorQuerySelectorAll(selector)[0] || null;
		  };
		})(this, Element.prototype, Array.prototype);

		/* Helper Functions
		/* ========================================================================== */

		function generateTableRow() {
		  var emptyColumn = document.createElement('tr');

		  emptyColumn.innerHTML = '<td width="60%"><a class="cut">-</a> <span  contenteditable></span></td>'+
        '<td width="15%"><span data-prefix>₹</span><span contenteditable>0.00</span></td>'+
        '<td width="10%"><span contenteditable></span> </td>'+
        '<td width="15%"><span data-prefix>₹</span><span>0.00</span></td>';

		  return emptyColumn;
		}

		function parseFloatHTML(element) {
		  return parseFloat(element.innerHTML.replace(/[^\d\.\-]+/g, '')) || 0;
		}

		function parsePrice(number) {
		  return number.toFixed(2).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g, '$1,');
		}

		/* Update Number
		/* ========================================================================== */

		function updateNumber(e) {
		  var
		  activeElement = document.activeElement,
		      value = parseFloat(activeElement.innerHTML),
		      wasPrice = activeElement.innerHTML == parsePrice(parseFloatHTML(activeElement));

		  if (!isNaN(value) && (e.keyCode == 38 || e.keyCode == 40 || e.wheelDeltaY)) {
		    e.preventDefault();

		    value += e.keyCode == 38 ? 1 : e.keyCode == 40 ? -1 : Math.round(e.wheelDelta * 0.025);
		    value = Math.max(value, 0);

		    activeElement.innerHTML = wasPrice ? parsePrice(value) : value;
		  }

		  updateInvoice();
		}

		/* Update Invoice
		/* ========================================================================== */

		function updateInvoice() {
		  var total = 0;
		  var cells, price, total, a, i;

		  // update inventory cells
		  // ======================

		  for (var a = document.querySelectorAll('table.inventory tbody tr'), i = 0; a[i]; ++i) {
		    // get inventory row cells
		    cells = a[i].querySelectorAll('span:last-child');

		    // set price as cell[1] * cell[2]
		    price = parseFloatHTML(cells[1]) * parseFloatHTML(cells[2]);

		    // add price to total
		    total += price;

		    // set row total
		    cells[3].innerHTML = price;
		  }

		  // update balance cells
		  // ====================

		  // get balance cells
		  cells = document.querySelectorAll('table.balance td:last-child span:last-child');

		  // set total
		  cells[0].innerHTML = total;
		 

		  // set balance and meta balance
		  cells[2].innerHTML = document.querySelector('table.meta tr:last-child td:last-child span:last-child').innerHTML = parsePrice(total - parseFloatHTML(cells[1]));

		  // update prefix formatting
		  // ========================

		  var prefix = document.querySelector('#prefix').innerHTML;
		  for (a = document.querySelectorAll('[data-prefix]'), i = 0; a[i]; ++i) a[i].innerHTML = prefix;

		  // update price formatting
		  // =======================

		  for (a = document.querySelectorAll('span[data-prefix] + span'), i = 0; a[i]; ++i) if (document.activeElement != a[i]) a[i].innerHTML = parsePrice(parseFloatHTML(a[i]));
		}

		/* On Content Load
		/* ========================================================================== */

		function onContentLoad() {
		  updateInvoice();

		  var
		  input = document.querySelector('input'),
		      image = document.querySelector('img');

		  function onClick(e) {
		    var element = e.target.querySelector('[contenteditable]'),
		        row;

		    element && e.target != document.documentElement && e.target != document.body && element.focus();

		    if (e.target.matchesSelector('.add')) {
		      document.querySelector('table.inventory tbody').appendChild(generateTableRow());
		    } else if (e.target.className == 'cut') {
		      row = e.target.ancestorQuerySelector('tr');

		      row.parentNode.removeChild(row);
		    }

		    updateInvoice();
		  }

		  function onEnterCancel(e) {
		    e.preventDefault();

		    image.classList.add('hover');
		  }

		  function onLeaveCancel(e) {
		    e.preventDefault();

		    image.classList.remove('hover');
		  }

		  function onFileInput(e) {
		    image.classList.remove('hover');

		    var
		    reader = new FileReader(),
		        files = e.dataTransfer ? e.dataTransfer.files : e.target.files,
		        i = 0;

		    reader.onload = onFileLoad;

		    while (files[i]) reader.readAsDataURL(files[i++]);
		  }

		  function onFileLoad(e) {
		    var data = e.target.result;

		    image.src = data;
		  }

		  if (window.addEventListener) {
		    document.addEventListener('click', onClick);

		    document.addEventListener('mousewheel', updateNumber);
		    document.addEventListener('keydown', updateNumber);

		    document.addEventListener('keydown', updateInvoice);
		    document.addEventListener('keyup', updateInvoice);

		    input.addEventListener('focus', onEnterCancel);
		    input.addEventListener('mouseover', onEnterCancel);
		    input.addEventListener('dragover', onEnterCancel);
		    input.addEventListener('dragenter', onEnterCancel);

		    input.addEventListener('blur', onLeaveCancel);
		    input.addEventListener('dragleave', onLeaveCancel);
		    input.addEventListener('mouseout', onLeaveCancel);

		    input.addEventListener('drop', onFileInput);
		    input.addEventListener('change', onFileInput);
		  }
		}

		window.addEventListener && document.addEventListener('DOMContentLoaded', onContentLoad);
</script>



<header>
  <h1>Invoice</h1> 
  <address contenteditable>
   
    <p><br></p>
    <p></p>
  </address>
  <span><img alt="" src="<%=@this_hospital.logo %>" width="280"><input type="file" accept="image/*"></span>
</header>
<article>


  
  <table class="meta">
    <tr>
      <th><span >Invoice #</span></th>
      <td><span contenteditable onblur="capturedata()" id="invoiceno">#SNR12XC</span></td>
    </tr>
    <tr>
      <th><span contenteditable>Date</span></th>
      <td><span contenteditable onblur="capturedata()">January 1, 2012</span></td>
    </tr>
    <tr>
      <th><span contenteditable>Amount Due</span></th>
      <td><span id="prefix" contenteditable onblur="capturedata()">₹</span><span>0.00</span></td>
    </tr>
  </table>

  
    <p><b>Patient: </b><span id="patientname" onblur="capturedata()" contenteditable> </span></p>
    <p><b>Doctor: </b><span id="doctorname" onblur="capturedata()" contenteditable> </span></p>

  <table class="inventory">
    <thead>
      <tr>
        <th width="60%"><span contenteditable>Particulars</span></th>
        
        <th width="15%"><span contenteditable>Rate</span></th>
        <th width="10%"><span contenteditable>Units</span></th>
        <th width="15%"><span contenteditable>Amount</span></th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td width="60%"><a class="cut">-</a> <span  contenteditable></span></td>
        
        <td width="15%"><span data-prefix>₹</span><span contenteditable>0.00</span></td>
        <td width="10%"><span contenteditable></span> </td>
        <td width="15%"><span data-prefix>₹</span><span>0.00</span></td>
      </tr>
    </tbody>
  </table>
  <a class="add" style="width:50px">+</a>
  <table class="balance">
    <tr>
      <th><span contenteditable>Total</span></th>
      <td><span data-prefix>₹</span><span id="totalamount" onblur="capturedata()">0.00</span></td>
    </tr>
    <tr>
      <th><span contenteditable>Amount Paid</span></th>
      <td><span  data-prefix>₹</span><span contenteditable id="amountpaid" onblur="capturedata()">0.00</span></td>
    </tr>
    <tr>
      <th><span contenteditable>Balance Due</span></th>
      <td><span data-prefix>₹</span><span id="balancedue" >0.00</span></td>
    </tr>
  </table>
</article>
<aside>
  <h1><span contenteditable>Additional Notes</span></h1>

  <div contenteditable onblur="capturedata()" id="notes">
    <p class="center-align">...</p>
  </div>
</aside>
